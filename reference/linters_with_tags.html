<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Make a new list based on all linters provided by packages and tagged with tags.
The result of this function is meant to be passed to the linters argument of lint(),
or to be put in your configuration file."><title>Create a tag-based linter configuration — linters_with_tags • lintr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a tag-based linter configuration — linters_with_tags"><meta property="og:description" content="Make a new list based on all linters provided by packages and tagged with tags.
The result of this function is meant to be passed to the linters argument of lint(),
or to be put in your configuration file."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="lintr.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lintr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/lintr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/continuous-integration.html">Continuous integration</a>
    <a class="dropdown-item" href="../articles/creating_linters.html">Creating new linters</a>
    <a class="dropdown-item" href="../articles/editors.html">Editor setup</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/lintr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create a tag-based linter configuration</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/lintr/blob/HEAD/R/with.R" class="external-link"><code>R/with.R</code></a></small>
      <div class="d-none name"><code>linters_with_tags.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Make a new list based on all linters provided by <code>packages</code> and tagged with <code>tags</code>.
The result of this function is meant to be passed to the <code>linters</code> argument of <code><a href="lint.html">lint()</a></code>,
or to be put in your configuration file.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">linters_with_tags</span><span class="op">(</span><span class="va">tags</span>, <span class="va">...</span>, packages <span class="op">=</span> <span class="st">"lintr"</span>, exclude_tags <span class="op">=</span> <span class="st">"deprecated"</span><span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>tags</dt>
<dd><p>Optional character vector of tags to search. Only linters with at least one matching tag will be
returned. If <code>tags</code> is <code>NULL</code>, all linters will be returned.</p></dd>
<dt>...</dt>
<dd><p>Arguments of elements to change. If unnamed, the argument is automatically named.
If the named argument already exists in the list of linters, it is replaced by the new element.
If it does not exist, it is added. If the value is <code>NULL</code>, the linter is removed.</p></dd>
<dt>packages</dt>
<dd><p>A character vector of packages to search for linters.</p></dd>
<dt>exclude_tags</dt>
<dd><p>Tags to exclude from the results. Linters with at least one matching tag will not be returned.
If <code>except_tags</code> is <code>NULL</code>, no linters will be excluded.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A modified list of linters.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="linters_with_defaults.html">linters_with_defaults</a> for basing off lintr's set of default linters.
<a href="available_linters.html">available_linters</a> to get a data frame of available linters.
<a href="linters.html">linters</a> for a complete list of linters available in lintr.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># `linters_with_defaults()` and `linters_with_tags("default")` are the same:</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="linters_with_defaults.html">linters_with_defaults</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu">linters_with_tags</span><span class="op">(</span><span class="st">"default"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Get all linters useful for package development</span></span>
<span class="r-in"><span class="fu">linters_with_tags</span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"package_development"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $backport_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (all(r_version &gt;= R_system_version(names(backports)))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     names_xpath &lt;- "//SYMBOL | //SYMBOL_FUNCTION_CALL"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     all_names_nodes &lt;- xml2::xml_find_all(xml, names_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     all_names &lt;- xml2::xml_text(all_names_nodes)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     backport_blacklist &lt;- backports[r_version &lt; R_system_version(names(backports))]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     needs_backport &lt;- do.call(cbind, lapply(backport_blacklist, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         function(nm) all_names %in% nm))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_idx &lt;- rowSums(needs_backport) &gt; 0L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(which(bad_idx), function(ii) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         node &lt;- all_names_nodes[[ii]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         line1 &lt;- xml2::xml_attr(node, "line1")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         col1 &lt;- as.integer(xml2::xml_attr(node, "col1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         col2 &lt;- as.integer(xml2::xml_attr(node, "col2"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         stopifnot(xml2::xml_attr(node, "line2") == line1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Lint(filename = source_expression$filename, line_number = as.integer(line1), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_number = col1, type = "warning", message = sprintf("%s (R %s) is not available for dependency R &gt;= %s.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 all_names[ii], names(backport_blacklist)[which(needs_backport[ii, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ])], r_version), line = source_expression$lines[[line1]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ranges = list(c(col1, col2)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9052ff558&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90533c3e8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "backport_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $conjunct_test_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (length(bad_expr) == 0L) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     matched_fun &lt;- xp_call_name(bad_expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     operator &lt;- xml2::xml_find_chr(bad_expr, "string(expr/*[self::AND2 or self::OR2])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     replacement_fmt &lt;- ifelse(matched_fun %in% c("expect_true", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "expect_false"), "write multiple expectations like %1$s(A) and %1$s(B)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "write multiple conditions like %s(A, B).")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lint_message &lt;- paste(sprintf("Instead of %s(A %s B),", matched_fun, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         operator), sprintf(replacement_fmt, matched_fun), "The latter will produce better error messages in the case of failure.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, lint_message = lint_message, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905307868&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9053bd1a8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "conjunct_test_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_comparison_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     comparator_nodes &lt;- setdiff(as.list(infix_metadata$xml_tag[infix_metadata$comparator]), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "NE")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'expect_true']]\n      and expr[2][ {xp_or(comparator_nodes)} ]\n      and not(SYMBOL_SUB[text() = 'info'])\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     comparator_expectation_map &lt;- c(`&gt;` = "expect_gt", `&gt;=` = "expect_gte", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         `&lt;` = "expect_lt", `&lt;=` = "expect_lte", `==` = "expect_identical")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         comparator &lt;- xml2::xml_find_chr(expr, "string(expr[2]/*[2])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         expectation &lt;- comparator_expectation_map[[comparator]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sprintf("%s(x, y) is better than expect_true(x %s y).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             expectation, comparator)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90530b7f8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c905433110&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_comparison_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_identical_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("Use expect_identical(x, y) by default; resort to expect_equal() only when needed,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "e.g. when setting ignore_attr= or tolerance=."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90530e138&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c905493a28&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_identical_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_length_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     matched_function &lt;- xp_call_name(bad_expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lint_message &lt;- sprintf("expect_length(x, n) is better than %s(length(x), n)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, lint_message, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90530ff08&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c905504c70&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_length_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_named_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']\n      and following-sibling::expr[\n        expr[SYMBOL_FUNCTION_CALL[text() = 'names']]\n        and (position() = 1 or preceding-sibling::expr[STR_CONST])\n      ]\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             matched_function &lt;- xp_call_name(expr, depth = 0L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_named(x, n) is better than %s(names(x), n)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9053119c8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90556cd48&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_named_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_not_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      SYMBOL_FUNCTION_CALL[text() = 'expect_true' or text() = 'expect_false']\n      and following-sibling::expr[1][OP-EXCLAMATION]\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "expect_false(x) is better than expect_true(!x), and vice versa.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905317168&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c902000630&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_not_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_null_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      (\n        SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']\n        and following-sibling::expr[position() &lt;= 2 and NULL_CONST]\n      ) or (\n        SYMBOL_FUNCTION_CALL[text() = 'expect_true']\n        and following-sibling::expr[1][expr[SYMBOL_FUNCTION_CALL[text() = 'is.null']]]\n      )\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         matched_function &lt;- xp_call_name(expr, depth = 0L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (matched_function %in% c("expect_equal", "expect_identical")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_null(x) is better than %s(x, NULL)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "expect_null(x) is better than expect_true(is.null(x))"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905318c60&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901f772d0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_null_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_s3_class_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     is_class_call &lt;- xp_text_in_table(c(is_s3_class_calls, "inherits"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      (\n        (\n          expr[SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']]\n          and expr[\n            expr[SYMBOL_FUNCTION_CALL[text() = 'class']]\n            and (position() = 2 or preceding-sibling::expr[STR_CONST])\n          ]\n        ) or (\n          expr[SYMBOL_FUNCTION_CALL[text() = 'expect_true']]\n          and expr[2][expr[SYMBOL_FUNCTION_CALL[ {is_class_call} ]]]\n        )\n      )\n      and not(SYMBOL_SUB[text() = 'info' or contains(text(), 'label')])\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         matched_function &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (matched_function %in% c("expect_equal", "expect_identical")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lint_msg &lt;- sprintf("expect_s3_class(x, k) is better than %s(class(x), k).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lint_msg &lt;- "expect_s3_class(x, k) is better than expect_true(is.&lt;k&gt;(x)) or expect_true(inherits(x, k))."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         paste(lint_msg, "Note also expect_s4_class() available for testing S4 objects.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90531d0c0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901f15ec8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_s3_class_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_s4_class_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'expect_true']]\n      and expr[2][count(expr) = 3 and expr[SYMBOL_FUNCTION_CALL[text() = 'is']]]\n      and not(SYMBOL_SUB[text() = 'info' or text() = 'label'])\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("expect_s4_class(x, k) is better than expect_true(is(x, k)).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "Note also expect_s3_class() available for testing S3 objects."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90531da70&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901e79848&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_s4_class_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_true_false_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[expr[\n      SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']\n      and following-sibling::expr[position() &lt;= 2 and NUM_CONST[text() = 'TRUE' or text() = 'FALSE']]\n    ]]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         call_name &lt;- xp_call_name(expr, condition = "starts-with(text(), 'expect_')")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         truth_value &lt;- xml2::xml_find_chr(expr, "string(expr/NUM_CONST[text() = 'TRUE' or text() = 'FALSE'])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (truth_value == "TRUE") {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_true(x) is better than %s(x, TRUE)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 call_name)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_false(x) is better than %s(x, FALSE)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 call_name)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90531f1b0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901da6368&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_true_false_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_type_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     base_type_tests &lt;- xp_text_in_table(paste0("is.", base_types))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      (\n        (\n          expr[SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']]\n          and expr[\n            expr[SYMBOL_FUNCTION_CALL[text() = 'typeof']]\n            and (position() = 2 or preceding-sibling::expr[STR_CONST])\n          ]\n        ) or (\n          expr[SYMBOL_FUNCTION_CALL[text() = 'expect_true']]\n          and expr[2][expr[SYMBOL_FUNCTION_CALL[ {base_type_tests} ]]]\n        )\n      )\n      and not(SYMBOL_SUB[text() = 'info' or contains(text(), 'label')])\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         matched_function &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (matched_function %in% c("expect_equal", "expect_identical")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_type(x, t) is better than %s(typeof(x), t)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "expect_type(x, t) is better than expect_true(is.&lt;t&gt;(x))"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905325300&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901d179c8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_type_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $package_hooks_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_msg_calls &lt;- c("cat", "message", "print", "writeLines")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_calls &lt;- list(.onLoad = c(bad_msg_calls, "packageStartupMessage"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         .onAttach = c(bad_msg_calls, "library.dynam"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     get_hook &lt;- function(xml) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ns_calls &lt;- xp_text_in_table(c(".onLoad", ".onAttach", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ".onDetach", ".Last.lib"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xml2::xml_text(xml2::xml_find_all(xml, sprintf("./ancestor::expr/expr/SYMBOL[%s]", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ns_calls)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_msg_calls &lt;- c("cat", "message", "print", "writeLines")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_calls &lt;- list(.onLoad = c(bad_msg_calls, "packageStartupMessage"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         .onAttach = c(bad_msg_calls, "library.dynam"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_msg_call_xpath_fmt &lt;- "\n      //expr[SYMBOL[text() = '%s']]\n      /following-sibling::expr[FUNCTION]\n      //SYMBOL_FUNCTION_CALL[%s]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_msg_call_lints &lt;- function(hook) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath &lt;- sprintf(bad_msg_call_xpath_fmt, hook, xp_text_in_table(bad_calls[[hook]]))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xml_nodes_to_lints(bad_expr, source_expression, make_bad_call_lint_msg(hook), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     onload_bad_msg_call_lints &lt;- bad_msg_call_lints(".onLoad")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     onattach_bad_msg_call_lints &lt;- bad_msg_call_lints(".onAttach")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     load_arg_name_xpath &lt;- "\n    //expr[SYMBOL[text() = '.onAttach' or text() = '.onLoad']]\n    /following-sibling::expr[\n      FUNCTION\n      and (\n        count(SYMBOL_FORMALS) != 2\n        or SYMBOL_FORMALS[\n          (position() = 1 and not(starts-with(text(), 'lib')))\n          or (position() = 2 and not(starts-with(text(), 'pkg')))\n        ]\n      )\n    ]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     load_arg_name_expr &lt;- xml2::xml_find_all(xml, load_arg_name_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     load_arg_name_lints &lt;- xml_nodes_to_lints(load_arg_name_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("%s() should take two arguments, with the first starting with 'lib' and the second starting with 'pkg'.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 get_hook(expr))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     library_require_xpath &lt;- "\n    //expr[SYMBOL[text() = '.onAttach' or text() = '.onLoad']]\n    /following-sibling::expr//*[\n      (self::SYMBOL or self::SYMBOL_FUNCTION_CALL)\n      and (text() = 'require' or text() = 'library' or text() = 'installed.packages')\n    ]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     library_require_expr &lt;- xml2::xml_find_all(xml, library_require_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     library_require_lints &lt;- xml_nodes_to_lints(library_require_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             bad_call &lt;- xml2::xml_text(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             hook &lt;- get_hook(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (bad_call == "installed.packages") {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 sprintf("Don't slow down package load by running installed.packages() in %s().", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   hook)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 sprintf("Don't alter the search() path in %s() by calling %s().", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   hook, bad_call)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_unload_call_xpath &lt;- "\n      //expr[SYMBOL[text() = '.Last.lib' or text() = '.onDetach']]\n      /following-sibling::expr[FUNCTION]\n      //SYMBOL_FUNCTION_CALL[text() = 'library.dynam.unload']\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_unload_call_expr &lt;- xml2::xml_find_all(xml, bad_unload_call_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_unload_call_lints &lt;- xml_nodes_to_lints(bad_unload_call_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression, function(expr) sprintf("Use library.dynam.unload() calls in .onUnload(), not %s().", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             get_hook(expr)), type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     unload_arg_name_xpath &lt;- "\n    //expr[SYMBOL[text() = '.onDetach' or text() = '.Last.lib']]\n    /following-sibling::expr[\n      FUNCTION\n      and (\n        count(SYMBOL_FORMALS) != 1\n        or SYMBOL_FORMALS[not(starts-with(text(), 'lib'))]\n      )\n    ]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     unload_arg_name_expr &lt;- xml2::xml_find_all(xml, unload_arg_name_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     unload_arg_name_lints &lt;- xml_nodes_to_lints(unload_arg_name_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression, function(expr) sprintf("%s() should take one argument starting with 'lib'.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             get_hook(expr)), type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return(c(onload_bad_msg_call_lints, onattach_bad_msg_call_lints, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         load_arg_name_lints, library_require_lints, bad_unload_call_lints, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         unload_arg_name_lints))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90532d1e8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901c8d7f8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "package_hooks_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $yoda_test_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     const_condition &lt;- "\n      NUM_CONST\n      or (STR_CONST and not(OP-DOLLAR))\n      or ((OP-PLUS or OP-MINUS) and count(expr[NUM_CONST]) = 2)\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical' or text() = 'expect_setequal']]\n      and expr[2][ {const_condition} ]\n      and not(preceding-sibling::*[self::PIPE or self::SPECIAL[text() = '%&gt;%']])\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             matched_call &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             second_const &lt;- xml2::xml_find_first(expr, glue::glue("expr[position() = 3 and ({const_condition})]"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (is.na(second_const)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paste("Tests should compare objects in the order 'actual', 'expected', not the reverse.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   sprintf("For example, do %1$s(foo(x), 2L) instead of %1$s(2L, foo(x)).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     matched_call))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 sprintf("Avoid storing placeholder tests like %s(1, 1)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   matched_call)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905338f80&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901c1fdb8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "yoda_test_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Get all linters provided by lintr</span></span>
<span class="r-in"><span class="fu">linters_with_tags</span><span class="op">(</span>tags <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $absolute_path_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(ids_with_token(source_expression, "STR_CONST"), function(id) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         token &lt;- with_id(source_expression, id)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         path &lt;- get_r_string(token$text)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (path_function(path)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             start &lt;- token[["col1"]] + 1L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             end &lt;- token[["col2"]] - 1L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Lint(filename = source_expression[["filename"]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line_number = token[["line1"]], column_number = start, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 type = "warning", message = message, line = source_expression[["lines"]][[as.character(token[["line1"]])]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 ranges = list(c(start, end)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901c98080&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901923038&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "absolute_path_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $any_duplicated_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     any_duplicated_xpath &lt;- "//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'any']]\n      and expr[expr[SYMBOL_FUNCTION_CALL[text() = 'duplicated']]]\n      and (\n        not(OP-COMMA)\n        or OP-COMMA[\n          not(preceding-sibling::OP-COMMA)\n          and following-sibling::SYMBOL_SUB[1][text() = 'na.rm']\n        ]\n      )\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     any_duplicated_expr &lt;- xml2::xml_find_all(xml, any_duplicated_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     any_duplicated_lints &lt;- xml_nodes_to_lints(any_duplicated_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression = source_expression, lint_message = "anyDuplicated(x, ...) &gt; 0 is better than any(duplicated(x), ...).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     path_to_neighbor_call_expr_fmt &lt;- file.path("parent::expr", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "parent::expr", "parent::expr", "expr", "expr[SYMBOL_FUNCTION_CALL[text()= '%s']]", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "following-sibling::expr")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     unique_expr_xpath &lt;- xp_and("SYMBOL_FUNCTION_CALL[text() = 'unique']", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xp_or(sprintf("following-sibling::expr = %s", sprintf(path_to_neighbor_call_expr_fmt, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "length")), sprintf("following-sibling::expr[OP-DOLLAR or LBB]/expr[1] = %s", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf(path_to_neighbor_call_expr_fmt, "nrow"))))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     length_unique_call_xpath &lt;- xp_and("expr[SYMBOL_FUNCTION_CALL[text() = 'length']]", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sprintf("expr[expr[%s]]", unique_expr_xpath))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     length_unique_xpath &lt;- sprintf("//expr[EQ or NE or GT or LT]/expr[%s]", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         length_unique_call_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     length_unique_xpath &lt;- "\n    //expr[EQ or NE or GT or LT]\n    /expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'length']]\n      and expr[expr[\n        SYMBOL_FUNCTION_CALL[text() = 'unique']\n        and (\n          following-sibling::expr =\n            parent::expr\n            /parent::expr\n            /parent::expr\n            /expr\n            /expr[SYMBOL_FUNCTION_CALL[text()= 'length']]\n            /following-sibling::expr\n          or\n          following-sibling::expr[OP-DOLLAR or LBB]/expr[1] =\n            parent::expr\n            /parent::expr\n            /parent::expr\n            /expr\n            /expr[SYMBOL_FUNCTION_CALL[text()= 'nrow']]\n            /following-sibling::expr\n        )\n      ]]\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     length_unique_expr &lt;- xml2::xml_find_all(xml, length_unique_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     length_unique_lints &lt;- xml_nodes_to_lints(length_unique_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression = source_expression, lint_message = "anyDuplicated(x) == 0L is better than length(unique(x)) == length(x) and length(unique(DF$col)) == nrow(DF)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return(c(any_duplicated_lints, length_unique_lints))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a5d250&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901878790&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "any_duplicated_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $any_is_na_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'any']]\n      and expr[expr[SYMBOL_FUNCTION_CALL[text() = 'is.na']]]\n      and (\n        count(expr) = 2\n        or (count(expr) = 3 and SYMBOL_SUB[text() = 'na.rm'])\n      )\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "anyNA(x) is better than any(is.na(x)).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a56d48&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9016ea840&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "any_is_na_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $assignment_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- paste(collapse = " | ", c("//EQ_ASSIGN", if (!allow_right_assign) "//RIGHT_ASSIGN" else if (!allow_cascading_assign) "//RIGHT_ASSIGN[text() = '-&gt;&gt;']", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (!allow_cascading_assign) "//LEFT_ASSIGN[text() = '&lt;&lt;-']"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         operator &lt;- xml2::xml_text(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (operator %in% c("&lt;&lt;-", "-&gt;&gt;")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste(operator, "can have hard-to-predict behavior;", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "prefer assigning to a specific environment instead (with assign() or &lt;-).")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste0("Use &lt;-, not ", operator, ", for assignment.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "style")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044bea98&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90155cb68&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "assignment_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $backport_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (all(r_version &gt;= R_system_version(names(backports)))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     names_xpath &lt;- "//SYMBOL | //SYMBOL_FUNCTION_CALL"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     all_names_nodes &lt;- xml2::xml_find_all(xml, names_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     all_names &lt;- xml2::xml_text(all_names_nodes)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     backport_blacklist &lt;- backports[r_version &lt; R_system_version(names(backports))]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     needs_backport &lt;- do.call(cbind, lapply(backport_blacklist, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         function(nm) all_names %in% nm))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_idx &lt;- rowSums(needs_backport) &gt; 0L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(which(bad_idx), function(ii) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         node &lt;- all_names_nodes[[ii]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         line1 &lt;- xml2::xml_attr(node, "line1")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         col1 &lt;- as.integer(xml2::xml_attr(node, "col1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         col2 &lt;- as.integer(xml2::xml_attr(node, "col2"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         stopifnot(xml2::xml_attr(node, "line2") == line1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Lint(filename = source_expression$filename, line_number = as.integer(line1), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_number = col1, type = "warning", message = sprintf("%s (R %s) is not available for dependency R &gt;= %s.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 all_names[ii], names(backport_blacklist)[which(needs_backport[ii, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ])], r_version), line = source_expression$lines[[line1]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ranges = list(c(col1, col2)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9052ff558&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90140aec8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "backport_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $brace_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- list()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_cond_open &lt;- xp_and(c(if (isTRUE(allow_single_line)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "(@line1 != following-sibling::OP-LEFT-BRACE/@line1)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, "not(\n        (@line1 = parent::expr/preceding-sibling::OP-LEFT-BRACE/@line1) or\n        (@line1 = following-sibling::expr/OP-LEFT-BRACE/@line1)\n      )", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "not(\n        @line1 = parent::expr/preceding-sibling::*[1][\n          self::OP-LEFT-PAREN or self::OP-COMMA or (self::SPECIAL and text() = '%&gt;%')\n        ]/@line2 + 1\n      )"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_open_curly &lt;- glue::glue("//OP-LEFT-BRACE[\n      { xp_cond_open } and (\n        not(@line1 = parent::expr/preceding-sibling::*/@line2) or\n        @line1 = following-sibling::*[1][not(self::COMMENT)]/@line1\n      )\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- c(lints, xml_nodes_to_lints(xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xp_open_curly), source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("Opening curly braces should never go on their own line and", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "should always be followed by a new line.")))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_open_preceding &lt;- "parent::expr/preceding-sibling::*[1][self::OP-RIGHT-PAREN or self::ELSE or self::REPEAT]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_paren_brace &lt;- glue::glue("//OP-LEFT-BRACE[\n      @line1 = { xp_open_preceding }/@line1\n      and\n      @col1 = { xp_open_preceding }/@col2 + 1\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- c(lints, xml_nodes_to_lints(xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xp_paren_brace), source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "There should be a space before an opening curly brace."))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_cond_closed &lt;- xp_and(c(if (isTRUE(allow_single_line)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "(@line1 != preceding-sibling::OP-LEFT-BRACE/@line1)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, "not(\n        @line1 = ancestor::expr/following-sibling::*[1][\n          self::OP-COMMA or self::OP-RIGHT-BRACKET or self::OP-RIGHT-PAREN\n        ]/@line1\n      )", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "not(\n        (@line1 = parent::expr/following-sibling::OP-RIGHT-BRACE/@line1) or\n        (@line1 = preceding-sibling::expr/OP-RIGHT-BRACE/@line1)\n      )"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_closed_curly &lt;- glue::glue("//OP-RIGHT-BRACE[\n      { xp_cond_closed } and (\n        (@line1 = preceding-sibling::*[1]/@line2) or\n        (@line1 = parent::expr/following-sibling::*[1][not(self::ELSE)]/@line1)\n      )\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- c(lints, xml_nodes_to_lints(xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xp_closed_curly), source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("Closing curly-braces should always be on their own line,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "unless they are followed by an else.")))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_else_closed_curly &lt;- "preceding-sibling::IF/following-sibling::expr[2]/OP-RIGHT-BRACE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_else_same_line &lt;- glue::glue("//ELSE[{xp_else_closed_curly} and @line1 != {xp_else_closed_curly}/@line2]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- c(lints, xml_nodes_to_lints(xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xp_else_same_line), source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "`else` should come on the same line as the previous `}`."))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_function_brace &lt;- "//expr[FUNCTION and @line1 != @line2 and not(expr[OP-LEFT-BRACE])]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- c(lints, xml_nodes_to_lints(xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xp_function_brace), source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "Any function spanning multiple lines should use curly braces."))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_if_else_match_brace &lt;- "\n    //IF[\n      following-sibling::expr[2][OP-LEFT-BRACE]\n      and following-sibling::ELSE\n          /following-sibling::expr[1][not(OP-LEFT-BRACE or IF/following-sibling::expr[2][OP-LEFT-BRACE])]\n    ]\n\n    |\n\n    //ELSE[\n      following-sibling::expr[1][OP-LEFT-BRACE]\n      and preceding-sibling::IF/following-sibling::expr[2][not(OP-LEFT-BRACE)]\n    ]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- c(lints, xml_nodes_to_lints(xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xp_if_else_match_brace), source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "Either both or neither branch in `if`/`else` should use curly braces."))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044c6590&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c901137040&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "brace_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $class_equals_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      not(preceding-sibling::OP-LEFT-BRACKET)\n      and expr[expr[SYMBOL_FUNCTION_CALL[text() = 'class']]]\n      and (EQ or NE or SPECIAL[text() = '%in%'])\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             op &lt;- xml2::xml_find_chr(expr, "string(*[2])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             message &lt;- sprintf("Instead of comparing class(x) with %s,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 op)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste(message, "use inherits(x, 'class-name') or is.&lt;class&gt; or is(x, 'class')")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a55330&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c900efd310&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "class_equals_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $commas_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     before_lints &lt;- xml_nodes_to_lints(xml2::xml_find_all(xml, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath_before), source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "Commas should never have a space before.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         range_start_xpath = "number(./preceding-sibling::*[1]/@col2 + 1)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         range_end_xpath = "number(./@col1 - 1)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     after_lints &lt;- xml_nodes_to_lints(xml2::xml_find_all(xml, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath_after), source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "Commas should always have a space after.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         range_start_xpath = "number(./@col2 + 1)", range_end_xpath = "number(./@col2 + 1)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     c(before_lints, after_lints)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044cc948&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c900e64ec8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "commas_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $commented_code_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     all_comment_nodes &lt;- xml2::xml_find_all(source_expression$full_xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "//COMMENT")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     all_comments &lt;- xml2::xml_text(all_comment_nodes)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     code_candidates &lt;- re_matches(all_comments, rex(some_of("#"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         any_spaces, capture(name = "code", anything, or(some_of("{}[]"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             or(ops), group(graphs, "(", anything, ")"), group("!", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 alphas)), anything)), global = FALSE, locations = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(rownames(na.omit(code_candidates)), function(code_candidate) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         is_parsable &lt;- parsable(code_candidates[code_candidate, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "code"])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (is_parsable) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             comment_node &lt;- all_comment_nodes[[as.integer(code_candidate)]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line_number &lt;- as.integer(xml2::xml_attr(comment_node, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "line1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_offset &lt;- as.integer(xml2::xml_attr(comment_node, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "col1")) - 1L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Lint(filename = source_expression$filename, line_number = line_number, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 column_number = column_offset + code_candidates[code_candidate, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   "code.start"], type = "style", message = "Commented code should be removed.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line = source_expression$file_lines[line_number], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 ranges = list(column_offset + c(code_candidates[code_candidate, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   "code.start"], code_candidates[code_candidate, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   "code.end"])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044d05c8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c900db3458&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "commented_code_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $condition_message_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     translators &lt;- c("packageStartupMessage", "message", "warning", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "stop")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[ {xp_text_in_table(translators)} ]]\n      and expr[\n        expr[SYMBOL_FUNCTION_CALL[text() = 'paste' or text() = 'paste0']]\n        and not(SYMBOL_SUB[text() = 'collapse'])\n      ]\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     sep_value &lt;- get_r_string(bad_expr, xpath = "./expr/SYMBOL_SUB[text() = 'sep']/following-sibling::expr/STR_CONST")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr[is.na(sep_value) | sep_value %in% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         c("", " ")], source_expression = source_expression, lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         outer_call &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         inner_call &lt;- xp_call_name(expr, depth = 2L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         message &lt;- sprintf("Don't use %s to build %s strings.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             inner_call, outer_call)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         paste(message, "Instead use the fact that these functions build condition message strings from their input", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "(using \"\" as a separator). For translateable strings, prefer using gettextf().")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a511a8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c900c79498&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "condition_message_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $conjunct_test_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (length(bad_expr) == 0L) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     matched_fun &lt;- xp_call_name(bad_expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     operator &lt;- xml2::xml_find_chr(bad_expr, "string(expr/*[self::AND2 or self::OR2])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     replacement_fmt &lt;- ifelse(matched_fun %in% c("expect_true", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "expect_false"), "write multiple expectations like %1$s(A) and %1$s(B)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "write multiple conditions like %s(A, B).")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lint_message &lt;- paste(sprintf("Instead of %s(A %s B),", matched_fun, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         operator), sprintf(replacement_fmt, matched_fun), "The latter will produce better error messages in the case of failure.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, lint_message = lint_message, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905307868&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c900b84800&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "conjunct_test_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $consecutive_stopifnot_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("\n    //expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'stopifnot']] = following-sibling::expr[1]/expr\n    ]\n    ")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "Unify consecutive calls to stopifnot().", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a4ce28&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c900a4b778&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "consecutive_stopifnot_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cyclocomp_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     complexity &lt;- try_silently(cyclocomp::cyclocomp(parse(text = source_expression$content)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (inherits(complexity, "try-error") || complexity &lt;= complexity_limit) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     col1 &lt;- source_expression[["column"]][1L]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Lint(filename = source_expression[["filename"]], line_number = source_expression[["line"]][1L], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         column_number = source_expression[["column"]][1L], type = "style", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         message = paste0("functions should have cyclomatic complexity of less than ", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             complexity_limit, ", this has ", complexity, "."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ranges = list(rep(col1, 2L)), line = source_expression$lines[1L])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044d7800&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9009c6c28&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "cyclocomp_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $duplicate_argument_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[EQ_SUB]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     calls &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (length(except)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         calls_text &lt;- get_r_string(calls, xpath = "expr[1][count(*)=1]/*[1]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         calls &lt;- calls[!(calls_text %in% except)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     result &lt;- lapply(calls, function(call) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         args &lt;- xml2::xml_find_all(call, "EQ_SUB/preceding-sibling::*[1]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         args_text &lt;- vapply(parse(text = xml2::xml_text(args), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             keep.source = FALSE), as.character, character(1L))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         is_dup_arg &lt;- duplicated(args_text)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         dup_args &lt;- args[is_dup_arg]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (length(dup_args)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line1 &lt;- as.integer(xml2::xml_attr(dup_args, "line1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line2 &lt;- as.integer(xml2::xml_attr(dup_args, "line2"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             col1 &lt;- as.integer(xml2::xml_attr(dup_args, "col1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             col2 &lt;- as.integer(xml2::xml_attr(dup_args, "col2"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             col2[line2 &gt; line1] &lt;- nchar(source_expression$file_lines[line1[line2 &gt; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line1]])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lapply(seq_along(dup_args), function(i) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Lint(filename = source_expression$filename, line_number = line1[[i]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   column_number = col1[[i]], type = "warning", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   message = "Duplicate arguments in function call.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   line = source_expression$file_lines[line1[[i]]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ranges = list(c(col1[[i]], col2[[i]])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     unlist(result, recursive = FALSE, use.names = FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a4a558&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9008f68e8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "duplicate_argument_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $equals_na_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     comparators &lt;- c("EQ", "NE")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     comparator_table &lt;- paste0("self::", comparators, collapse = " or ")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     na_table &lt;- xp_text_in_table(c("NA", "NA_integer_", "NA_real_", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "NA_complex_", "NA_character_"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath_fmt &lt;- "//expr[expr[NUM_CONST[%s]]]/*[%s]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- sprintf(xpath_fmt, na_table, comparator_table)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, lint_message = "Use is.na for comparisons to NA (not == or !=)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044dbfa8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9008608a0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "equals_na_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_comparison_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     comparator_nodes &lt;- setdiff(as.list(infix_metadata$xml_tag[infix_metadata$comparator]), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "NE")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'expect_true']]\n      and expr[2][ {xp_or(comparator_nodes)} ]\n      and not(SYMBOL_SUB[text() = 'info'])\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     comparator_expectation_map &lt;- c(`&gt;` = "expect_gt", `&gt;=` = "expect_gte", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         `&lt;` = "expect_lt", `&lt;=` = "expect_lte", `==` = "expect_identical")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         comparator &lt;- xml2::xml_find_chr(expr, "string(expr[2]/*[2])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         expectation &lt;- comparator_expectation_map[[comparator]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sprintf("%s(x, y) is better than expect_true(x %s y).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             expectation, comparator)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90530b7f8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9007d12a0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_comparison_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_identical_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("Use expect_identical(x, y) by default; resort to expect_equal() only when needed,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "e.g. when setting ignore_attr= or tolerance=."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90530e138&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9007584c8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_identical_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_length_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     matched_function &lt;- xp_call_name(bad_expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lint_message &lt;- sprintf("expect_length(x, n) is better than %s(length(x), n)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, lint_message, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90530ff08&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9006b8df8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_length_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_named_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']\n      and following-sibling::expr[\n        expr[SYMBOL_FUNCTION_CALL[text() = 'names']]\n        and (position() = 1 or preceding-sibling::expr[STR_CONST])\n      ]\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             matched_function &lt;- xp_call_name(expr, depth = 0L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_named(x, n) is better than %s(names(x), n)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9053119c8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9004d5490&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_named_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_not_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      SYMBOL_FUNCTION_CALL[text() = 'expect_true' or text() = 'expect_false']\n      and following-sibling::expr[1][OP-EXCLAMATION]\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "expect_false(x) is better than expect_true(!x), and vice versa.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905317168&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9003d5fa8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_not_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_null_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      (\n        SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']\n        and following-sibling::expr[position() &lt;= 2 and NULL_CONST]\n      ) or (\n        SYMBOL_FUNCTION_CALL[text() = 'expect_true']\n        and following-sibling::expr[1][expr[SYMBOL_FUNCTION_CALL[text() = 'is.null']]]\n      )\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         matched_function &lt;- xp_call_name(expr, depth = 0L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (matched_function %in% c("expect_equal", "expect_identical")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_null(x) is better than %s(x, NULL)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "expect_null(x) is better than expect_true(is.null(x))"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905318c60&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c900366e68&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_null_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_s3_class_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     is_class_call &lt;- xp_text_in_table(c(is_s3_class_calls, "inherits"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      (\n        (\n          expr[SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']]\n          and expr[\n            expr[SYMBOL_FUNCTION_CALL[text() = 'class']]\n            and (position() = 2 or preceding-sibling::expr[STR_CONST])\n          ]\n        ) or (\n          expr[SYMBOL_FUNCTION_CALL[text() = 'expect_true']]\n          and expr[2][expr[SYMBOL_FUNCTION_CALL[ {is_class_call} ]]]\n        )\n      )\n      and not(SYMBOL_SUB[text() = 'info' or contains(text(), 'label')])\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         matched_function &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (matched_function %in% c("expect_equal", "expect_identical")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lint_msg &lt;- sprintf("expect_s3_class(x, k) is better than %s(class(x), k).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lint_msg &lt;- "expect_s3_class(x, k) is better than expect_true(is.&lt;k&gt;(x)) or expect_true(inherits(x, k))."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         paste(lint_msg, "Note also expect_s4_class() available for testing S4 objects.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90531d0c0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9002d4b30&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_s3_class_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_s4_class_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'expect_true']]\n      and expr[2][count(expr) = 3 and expr[SYMBOL_FUNCTION_CALL[text() = 'is']]]\n      and not(SYMBOL_SUB[text() = 'info' or text() = 'label'])\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("expect_s4_class(x, k) is better than expect_true(is(x, k)).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "Note also expect_s3_class() available for testing S3 objects."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90531da70&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c900229948&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_s4_class_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_true_false_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[expr[\n      SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']\n      and following-sibling::expr[position() &lt;= 2 and NUM_CONST[text() = 'TRUE' or text() = 'FALSE']]\n    ]]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         call_name &lt;- xp_call_name(expr, condition = "starts-with(text(), 'expect_')")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         truth_value &lt;- xml2::xml_find_chr(expr, "string(expr/NUM_CONST[text() = 'TRUE' or text() = 'FALSE'])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (truth_value == "TRUE") {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_true(x) is better than %s(x, TRUE)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 call_name)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_false(x) is better than %s(x, FALSE)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 call_name)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90531f1b0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8ffc85668&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_true_false_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $expect_type_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     base_type_tests &lt;- xp_text_in_table(paste0("is.", base_types))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      (\n        (\n          expr[SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical']]\n          and expr[\n            expr[SYMBOL_FUNCTION_CALL[text() = 'typeof']]\n            and (position() = 2 or preceding-sibling::expr[STR_CONST])\n          ]\n        ) or (\n          expr[SYMBOL_FUNCTION_CALL[text() = 'expect_true']]\n          and expr[2][expr[SYMBOL_FUNCTION_CALL[ {base_type_tests} ]]]\n        )\n      )\n      and not(SYMBOL_SUB[text() = 'info' or contains(text(), 'label')])\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         matched_function &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (matched_function %in% c("expect_equal", "expect_identical")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("expect_type(x, t) is better than %s(typeof(x), t)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_function)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "expect_type(x, t) is better than expect_true(is.&lt;t&gt;(x))"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905325300&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8ff6e8678&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "expect_type_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extraction_operator_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tokens &lt;- source_expression[["parsed_content"]] &lt;- filter_out_token_type(source_expression[["parsed_content"]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "expr")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(ids_with_token(source_expression, c("'$'", "'['"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         fun = `%in%`), function(token_num) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (is_dollar_extract(token_num, tokens) || is_bracket_extract(token_num, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             tokens)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             token &lt;- with_id(source_expression, token_num)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             start_col_num &lt;- token[["col1"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             end_col_num &lt;- token[["col2"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line_num &lt;- token[["line1"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line &lt;- source_expression[["lines"]][[as.character(line_num)]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Lint(filename = source_expression[["filename"]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line_number = line_num, column_number = start_col_num, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 type = "warning", message = sprintf("Use `[[` instead of `%s`  to extract an element.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   token[["text"]]), line = line, ranges = list(c(start_col_num, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   end_col_num)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a38e60&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8ff5a1c30&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "extraction_operator_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $fixed_regex_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     pos_1_regex_funs &lt;- xp_text_in_table(c("grep", "gsub", "sub", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "regexec", "grepl", "regexpr", "gregexpr"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     pos_2_regex_funs &lt;- xp_text_in_table(c("strsplit", "tstrsplit", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "str_count", "str_detect", "str_ends", "str_extract", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "str_extract_all", "str_locate", "str_locate_all", "str_match", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "str_match_all", "str_remove", "str_remove_all", "str_replace", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "str_replace_all", "str_split", "str_starts", "str_subset", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "str_view", "str_view_all", "str_which"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      SYMBOL_FUNCTION_CALL[ {pos_1_regex_funs} ]\n      and not(following-sibling::SYMBOL_SUB[\n        (text() = 'fixed' or text() = 'ignore.case')\n        and following-sibling::expr[1][NUM_CONST[text() = 'TRUE'] or SYMBOL[text() = 'T']]\n      ])\n    ]\n    /following-sibling::expr[1][STR_CONST and not(EQ_SUB)]\n    |\n    //expr[\n      SYMBOL_FUNCTION_CALL[ {pos_2_regex_funs} ]\n      and not(following-sibling::SYMBOL_SUB[\n        text() = 'fixed'\n        and following-sibling::expr[1][NUM_CONST[text() = 'TRUE'] or SYMBOL[text() = 'T']]\n      ])\n    ]\n    /following-sibling::expr[2][STR_CONST and not(EQ_SUB)]\n    ")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     patterns &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(patterns[is_not_regex(xml2::xml_text(patterns))], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression = source_expression, lint_message = paste("For static regular expression patterns, set `fixed = TRUE`.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "Note that this includes regular expressions that can be expressed as", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "fixed patterns, e.g. [.] is really just . and \\$ is really just $", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "if there are no other regular expression specials. For functions from", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "the 'stringr' package, the way to declare a static string is to", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "wrap the pattern in stringr::fixed().", "If this is being used in a dbplyr context (i.e., translated to sql),", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "replace the regular expression with the `LIKE` operator using the", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "`%LIKE%` infix function.", "Lastly, take care to remember that the `replacement` argument of", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "`gsub()` is affected by the `fixed` argument as well."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a34ad0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8ff3e7dd0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "fixed_regex_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $function_left_parentheses_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(ids_with_token(source_expression, "'('"), function(id) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         parsed &lt;- source_expression$parsed_content[id, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         terminal_tokens_before &lt;- source_expression$parsed_content$line1 == </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             parsed$line1 &amp; source_expression$parsed_content$col1 &lt; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             parsed$col1 &amp; source_expression$parsed_content$terminal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         last_type &lt;- tail(source_expression$parsed_content$token[terminal_tokens_before], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             n = 1L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         is_function_call &lt;- length(last_type) %!=% 0L &amp;&amp; (last_type %in% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             c("SYMBOL_FUNCTION_CALL", "FUNCTION", "'}'", "']'"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (is_function_call) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line &lt;- source_expression$lines[as.character(parsed$line1)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             before_operator &lt;- substr(line, parsed$col1 - 1L, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 parsed$col1 - 1L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             space_before &lt;- re_matches(before_operator, rex(space))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (space_before) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Lint(filename = source_expression$filename, line_number = parsed$line1, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   column_number = parsed$col1, type = "style", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   message = "Remove spaces before the left parenthesis in a function call.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   line = line)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044df8a8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8ff0ff5e8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "function_left_parentheses_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ifelse_censor_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[ {xp_text_in_table(ifelse_funs)} ]]\n      and expr[2][\n        (LT or GT or LE or GE)\n        and expr[1] = following-sibling::expr\n        and expr[2] = following-sibling::expr\n      ]\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             matched_call &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             op &lt;- xml2::xml_find_chr(expr, "string(expr[2]/*[2])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             match_first &lt;- !is.na(xml2::xml_find_first(expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "expr[2][expr[1] = following-sibling::expr[1]]"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (op %in% c("&lt;", "&lt;=")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (match_first) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   sprintf("pmin(x, y) is preferable to %s(x %s y, x, y).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     matched_call, op)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   sprintf("pmax(x, y) is preferable to %s(x %s y, y, x).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     matched_call, op)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (match_first) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   sprintf("pmax(x, y) is preferable to %s(x %s y, x, y).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     matched_call, op)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   sprintf("pmin(x, y) is preferable to %s(x %s y, y, x).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     matched_call, op)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a2d9f8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8feeca2d0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "ifelse_censor_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $implicit_integer_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     numbers &lt;- xml2::xml_find_all(xml, "//NUM_CONST")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(numbers[is_implicit_integer(xml2::xml_text(numbers))], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression = source_expression, lint_message = "Integers should not be implicit. Use the form 1L for integers or 1.0 for doubles.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "style", column_number_xpath = "number(./@col2 + 1)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         range_end_xpath = "number(./@col2 + 1)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a2a980&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8fe93f660&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "implicit_integer_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $infix_spaces_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = lint_message, type = "style")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044ee018&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8fd125cd0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "infix_spaces_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $inner_combine_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     no_arg_vectorized_funs &lt;- c("sin", "cos", "tan", "sinpi", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "cospi", "tanpi", "asin", "acos", "atan", "log2", "log10", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "log1p", "exp", "expm1", "sqrt", "abs")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     date_args &lt;- c("format", "origin", "tz", "tryFormats")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     date_funs &lt;- c("as.Date", "as.POSIXct", "as.POSIXlt")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     log_funs &lt;- c("log", "logb")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     log_args &lt;- "base"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lubridate_args &lt;- c("quiet", "tz", "locale", "truncated")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lubridate_funs &lt;- c("ymd", "ydm", "mdy", "myd", "dmy", "dym", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "yq", "ym", "my", "ymd_hms", "ymd_hm", "ymd_h", "dmy_hms", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "dmy_hm", "dmy_h", "mdy_hms", "mdy_hm", "mdy_h", "ydm_hms", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "ydm_hm", "ydm_h")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     date_args_cond &lt;- build_arg_condition(date_funs, date_args)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     log_args_cond &lt;- build_arg_condition(log_funs, log_args)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lubridate_args_cond &lt;- build_arg_condition(lubridate_funs, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lubridate_args)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     c_expr_cond &lt;- xp_and(sprintf("expr[SYMBOL_FUNCTION_CALL[%s]]", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xp_text_in_table(c(no_arg_vectorized_funs, date_funs, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             log_funs, lubridate_funs))), "not(following-sibling::expr[not(expr[SYMBOL_FUNCTION_CALL])])", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "not(expr/SYMBOL_FUNCTION_CALL != following-sibling::expr/expr/SYMBOL_FUNCTION_CALL)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         date_args_cond, log_args_cond, lubridate_args_cond)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      count(expr) &gt; 2\n      and expr[\n        SYMBOL_FUNCTION_CALL[text() = 'c']\n        and following-sibling::expr[1][ {c_expr_cond} ]\n      ]\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             matched_call &lt;- xp_call_name(expr, depth = 2L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             message &lt;- sprintf("%1$s(c(x, y)) only runs the more expensive %1$s() once as compared to c(%1$s(x), %1$s(y)).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_call)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste("Combine inputs to vectorized functions first to take full advantage of vectorization, e.g.,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 message)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a27470&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8fcd66b18&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "inner_combine_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $line_length_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     line_lengths &lt;- nchar(source_expression$file_lines)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     long_lines &lt;- which(line_lengths &gt; length)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lint_message &lt;- sprintf("Lines should not be more than %d characters.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         length)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(long_lines, function(long_line) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Lint(filename = source_expression$filename, line_number = long_line, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_number = length + 1L, type = "style", message = lint_message, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line = source_expression$file_lines[long_line], ranges = list(c(1L, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line_lengths[long_line])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901f5e648&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8fe60b950&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "line_length_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $literal_coercion_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     coercers &lt;- xp_text_in_table(paste0("as.", c("logical", "integer", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "numeric", "double", "character")))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[ {coercers} ]]\n      and expr[2][\n        not(OP-DOLLAR)\n        and (\n          NUM_CONST[not(contains(translate(text(), 'E', 'e'), 'e'))]\n          or STR_CONST[not(following-sibling::*[1][self::EQ_SUB])]\n        )\n      ]\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("Use literals directly where possible, instead of coercion.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "c.f. 1L instead of as.integer(1), or NA_real_ instead of as.numeric(NA)."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a1b5c0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c8fdd0fd40&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "literal_coercion_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $missing_argument_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[expr[SYMBOL_FUNCTION_CALL]]/*[\n      self::OP-COMMA[preceding-sibling::*[not(self::COMMENT)][1][self::OP-LEFT-PAREN or self::OP-COMMA]] or\n      self::OP-COMMA[following-sibling::*[not(self::COMMENT)][1][self::OP-RIGHT-PAREN]] or\n      self::EQ_SUB[following-sibling::*[not(self::COMMENT)][1][self::OP-RIGHT-PAREN or self::OP-COMMA]]\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     missing_args &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     line1 &lt;- as.integer(xml2::xml_attr(missing_args, "line1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     col1 &lt;- as.integer(xml2::xml_attr(missing_args, "col1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     col2 &lt;- as.integer(xml2::xml_attr(missing_args, "col2"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     result &lt;- lapply(seq_along(missing_args), function(i) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         func &lt;- xml2::xml_find_all(missing_args[[i]], "preceding-sibling::expr/SYMBOL_FUNCTION_CALL")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         func &lt;- xml2::xml_text(func)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (length(func) == 1L &amp;&amp; !(func %in% except)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Lint(filename = source_expression$filename, line_number = line1[[i]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 column_number = col1[[i]], type = "warning", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 message = "Missing argument in function call.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line = source_expression$file_lines[[line1[[i]]]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 ranges = list(c(col1[[i]], col2[[i]])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     result[vapply(result, is.list, logical(1L))]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a15080&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9023c5dd0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "missing_argument_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $missing_package_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     call_xpath &lt;- "//expr[\n      (\n        expr[SYMBOL_FUNCTION_CALL[text() = 'library' or text() = 'require']]\n        and (\n          expr[2][STR_CONST]\n          or (\n            expr[2][SYMBOL]\n            and not(\n              SYMBOL_SUB[text() = 'character.only']\n              /following-sibling::expr[1]\n              /NUM_CONST[text() = 'TRUE' or text() = 'T']\n            )\n          )\n        )\n      ) or (\n        expr[SYMBOL_FUNCTION_CALL[text() = 'loadNamespace' or text() = 'requireNamespace']]\n        and expr[2][STR_CONST]\n      )\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     pkg_calls &lt;- xml2::xml_find_all(xml, call_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     pkg_names &lt;- get_r_string(xml2::xml_find_all(pkg_calls, "OP-LEFT-PAREN[1]/following-sibling::expr[1][SYMBOL | STR_CONST]"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     installed_packges &lt;- .packages(all.available = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     missing_ids &lt;- which(!(pkg_names %in% installed_packges))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     line1 &lt;- as.integer(xml2::xml_attr(pkg_calls, "line1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     col1 &lt;- as.integer(xml2::xml_attr(pkg_calls, "col1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     col2 &lt;- as.integer(xml2::xml_attr(pkg_calls, "col2"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(missing_ids, function(i) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Lint(filename = source_expression$filename, line_number = line1[[i]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_number = col1[[i]], type = "warning", message = sprintf("Package '%s' is not installed.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 pkg_names[[i]]), line = source_expression$file_lines[[line1[[i]]]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ranges = list(c(col1[[i]], col2[[i]])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901a0b5c0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90206dc40&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "missing_package_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $namespace_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ns_nodes &lt;- xml2::xml_find_all(xml, "//NS_GET | //NS_GET_INT")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (length(ns_nodes) == 0L) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     package_nodes &lt;- xml2::xml_find_all(ns_nodes, "preceding-sibling::*[1]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     packages &lt;- get_r_string(package_nodes)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- list()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     installed_packages &lt;- .packages(all.available = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     installed &lt;- packages %in% installed_packages</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!all(installed)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lints &lt;- c(lints, xml_nodes_to_lints(package_nodes[!installed], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             source_expression = source_expression, lint_message = sprintf("Package '%s' is not installed.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 packages[!installed]), type = "warning"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ns_nodes &lt;- ns_nodes[installed]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         packages &lt;- packages[installed]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         package_nodes &lt;- package_nodes[installed]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!check_exports &amp;&amp; !check_nonexports) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(lints)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     namespaces &lt;- lapply(packages, function(package) tryCatch(getNamespace(package), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         error = identity))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     failed_namespace &lt;- vapply(namespaces, inherits, "condition", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         FUN.VALUE = logical(1L))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (any(failed_namespace)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lints &lt;- c(lints, xml_nodes_to_lints(package_nodes[failed_namespace], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             source_expression = source_expression, lint_message = vapply(namespaces[failed_namespace], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 conditionMessage, character(1L)), type = "warning"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ns_nodes &lt;- ns_nodes[!failed_namespace]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         packages &lt;- packages[!failed_namespace]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         namespaces &lt;- namespaces[!failed_namespace]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ns_get &lt;- xml2::xml_text(ns_nodes) == "::"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     symbol_nodes &lt;- xml2::xml_find_all(ns_nodes, "following-sibling::*[1]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     symbols &lt;- get_r_string(symbol_nodes)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (check_nonexports) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lints &lt;- c(lints, build_ns_get_int_lints(packages[!ns_get], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             symbols[!ns_get], symbol_nodes[!ns_get], namespaces[!ns_get], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             source_expression))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (check_exports) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lints &lt;- c(lints, build_ns_get_lints(packages[ns_get], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             symbols[ns_get], symbol_nodes[ns_get], namespaces[ns_get], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             source_expression))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9019fb2e8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c902fbb820&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "namespace_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $nested_ifelse_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("\n    //expr[expr[SYMBOL_FUNCTION_CALL[ {xp_text_in_table(ifelse_funs)} ]]]\n    /expr[expr[SYMBOL_FUNCTION_CALL[ {xp_text_in_table(ifelse_funs)} ]]]\n    ")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             matched_call &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lint_message &lt;- sprintf("Don't use nested %s() calls;", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_call)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste(lint_message, "instead, try (1) data.table::fcase; (2) dplyr::case_when; or (3) using a lookup table.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9019eedd0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9030c8c78&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "nested_ifelse_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $no_tab_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     all_matches &lt;- re_matches(source_expression[["lines"]], regex, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         locations = TRUE, global = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     line_numbers &lt;- as.integer(names(source_expression[["lines"]]))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- Map(function(line_matches, line_number) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lapply(split(line_matches, seq_len(nrow(line_matches))), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             function(.match) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (is.na(.match[["start"]]) || .in_ignorable_position(source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   line_number, .match)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   return()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 start &lt;- .match[["start"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 end &lt;- .match[["end"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Lint(filename = source_expression[["filename"]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   line_number = line_number, column_number = start, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   type = lint_type, message = lint_msg, line = source_expression[["lines"]][[as.character(line_number)]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ranges = list(c(start, end)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, all_matches, line_numbers)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Filter(function(x) any(lengths(x) &gt; 0L), lints)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044eeaa8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90311e6a0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "no_tab_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $nonportable_path_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(ids_with_token(source_expression, "STR_CONST"), function(id) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         token &lt;- with_id(source_expression, id)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         path &lt;- get_r_string(token$text)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (path_function(path)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             start &lt;- token[["col1"]] + 1L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             end &lt;- token[["col2"]] - 1L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Lint(filename = source_expression[["filename"]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line_number = token[["line1"]], column_number = start, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 type = "warning", message = message, line = source_expression[["lines"]][[as.character(token[["line1"]])]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 ranges = list(c(start, end)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901c98080&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9031809a0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "nonportable_path_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $numeric_leading_zero_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//NUM_CONST[starts-with(text(), '.')]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "Include the leading zero for fractional numeric constants.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9019c9080&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9032d8950&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "numeric_leading_zero_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $object_length_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     assignments &lt;- xml2::xml_find_all(xml, object_name_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     nms &lt;- strip_names(xml2::xml_text(assignments))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ns_imports &lt;- namespace_imports(find_package(source_expression$filename))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     generics &lt;- strip_names(c(declared_s3_generics(xml), imported_s3_generics(ns_imports)$fun, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         .base_s3_generics))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     generics &lt;- unique(generics[nzchar(generics)])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     nms_stripped &lt;- re_substitutes(nms, rex(start, or(generics), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "."), "")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     too_long &lt;- nchar(nms_stripped) &gt; length</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(assignments[too_long], source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = lint_message, type = "style")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9044f9438&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903339d20&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "object_length_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $object_name_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     assignments &lt;- xml2::xml_find_all(xml, object_name_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     nms &lt;- strip_names(xml2::xml_text(assignments))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     generics &lt;- c(declared_s3_generics(xml), imported_s3_generics(namespace_imports(find_package(source_expression$filename)))$fun, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         .base_s3_generics)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     generics &lt;- unique(generics[nzchar(generics)])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     style_matches &lt;- lapply(styles, function(style) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         check_style(nms, style, generics)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     matches_a_style &lt;- Reduce(`|`, style_matches)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(assignments[!matches_a_style], source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = lint_message, type = "style")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901e07968&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903398be8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "object_name_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $object_usage_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     pkg_name &lt;- pkg_name(find_package(dirname(source_expression$filename)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     env &lt;- make_check_env(pkg_name)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     declared_globals &lt;- try_silently(utils::globalVariables(package = pkg_name %||% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         globalenv()))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     symbols &lt;- c(get_assignment_symbols(source_expression$full_xml_parsed_content), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         get_imported_symbols(source_expression$full_xml_parsed_content))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (symbol in symbols) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         assign(symbol, function(...) invisible(), envir = env)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fun_info &lt;- get_function_assignments(source_expression$full_xml_parsed_content)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(seq_len(NROW(fun_info)), function(i) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         info &lt;- fun_info[i, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         code &lt;- get_content(lines = source_expression$content[seq(info$line1, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             info$line2)], info)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         fun &lt;- try_silently(eval(envir = env, parse(text = code, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             keep.source = TRUE)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (inherits(fun, "try-error")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             return()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         known_used_symbols &lt;- get_used_symbols(info$expr[[1L]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             interpret_glue = interpret_glue)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         res &lt;- parse_check_usage(fun, known_used_symbols = known_used_symbols, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             declared_globals = declared_globals)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lapply(which(!is.na(res$message)), function(row_num) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             row &lt;- res[row_num, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             org_line_num &lt;- as.integer(row$line1) + info$line1 - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 1L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line &lt;- source_expression$content[as.integer(org_line_num)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             row$name &lt;- re_substitutes(row$name, rex("&lt;-"), "")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             location &lt;- re_matches(line, rex(boundary, row$name, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 boundary), locations = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (is.na(location$start) &amp;&amp; nzchar(row$line2) &amp;&amp; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 row$line2 != row$line1) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 lines &lt;- source_expression$content[org_line_num:(as.integer(row$line2) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   info$line1 - 1L)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 locations &lt;- re_matches(lines, rex(boundary, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   row$name, boundary), locations = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matching_row &lt;- (which(!is.na(locations$start)) %||% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   1L)[[1L]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 org_line_num &lt;- org_line_num + matching_row - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   1L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 location &lt;- locations[matching_row, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line &lt;- lines[matching_row]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (is.na(location$start)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 location$start &lt;- 1L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 location$end &lt;- nchar(line)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Lint(filename = source_expression$filename, line_number = org_line_num, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 column_number = location$start, type = "warning", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 message = row$message, line = line, ranges = list(c(location$start, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   location$end)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9045020f8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9033fe140&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "object_usage_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $outer_negation_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'any' or text() = 'all']]\n      and count(expr) &gt; 1\n      and not(expr[\n        position() &gt; 1\n        and not(OP-EXCLAMATION)\n        and not(preceding-sibling::*[2][self::SYMBOL_SUB])\n      ])\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             matched_call &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             inverse_call &lt;- if (matched_call == "any") </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "all"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else "any"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             message &lt;- sprintf("!%s(x) is better than %s(!x).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 inverse_call, matched_call)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste(message, "The former applies negation only once after aggregation instead of many times for each element of x.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9019c0b08&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90345f5b8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "outer_negation_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $package_hooks_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_msg_calls &lt;- c("cat", "message", "print", "writeLines")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_calls &lt;- list(.onLoad = c(bad_msg_calls, "packageStartupMessage"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         .onAttach = c(bad_msg_calls, "library.dynam"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     get_hook &lt;- function(xml) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ns_calls &lt;- xp_text_in_table(c(".onLoad", ".onAttach", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ".onDetach", ".Last.lib"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xml2::xml_text(xml2::xml_find_all(xml, sprintf("./ancestor::expr/expr/SYMBOL[%s]", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ns_calls)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_msg_calls &lt;- c("cat", "message", "print", "writeLines")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_calls &lt;- list(.onLoad = c(bad_msg_calls, "packageStartupMessage"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         .onAttach = c(bad_msg_calls, "library.dynam"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_msg_call_xpath_fmt &lt;- "\n      //expr[SYMBOL[text() = '%s']]\n      /following-sibling::expr[FUNCTION]\n      //SYMBOL_FUNCTION_CALL[%s]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_msg_call_lints &lt;- function(hook) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath &lt;- sprintf(bad_msg_call_xpath_fmt, hook, xp_text_in_table(bad_calls[[hook]]))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xml_nodes_to_lints(bad_expr, source_expression, make_bad_call_lint_msg(hook), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     onload_bad_msg_call_lints &lt;- bad_msg_call_lints(".onLoad")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     onattach_bad_msg_call_lints &lt;- bad_msg_call_lints(".onAttach")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     load_arg_name_xpath &lt;- "\n    //expr[SYMBOL[text() = '.onAttach' or text() = '.onLoad']]\n    /following-sibling::expr[\n      FUNCTION\n      and (\n        count(SYMBOL_FORMALS) != 2\n        or SYMBOL_FORMALS[\n          (position() = 1 and not(starts-with(text(), 'lib')))\n          or (position() = 2 and not(starts-with(text(), 'pkg')))\n        ]\n      )\n    ]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     load_arg_name_expr &lt;- xml2::xml_find_all(xml, load_arg_name_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     load_arg_name_lints &lt;- xml_nodes_to_lints(load_arg_name_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("%s() should take two arguments, with the first starting with 'lib' and the second starting with 'pkg'.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 get_hook(expr))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     library_require_xpath &lt;- "\n    //expr[SYMBOL[text() = '.onAttach' or text() = '.onLoad']]\n    /following-sibling::expr//*[\n      (self::SYMBOL or self::SYMBOL_FUNCTION_CALL)\n      and (text() = 'require' or text() = 'library' or text() = 'installed.packages')\n    ]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     library_require_expr &lt;- xml2::xml_find_all(xml, library_require_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     library_require_lints &lt;- xml_nodes_to_lints(library_require_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression, function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             bad_call &lt;- xml2::xml_text(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             hook &lt;- get_hook(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (bad_call == "installed.packages") {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 sprintf("Don't slow down package load by running installed.packages() in %s().", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   hook)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 sprintf("Don't alter the search() path in %s() by calling %s().", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   hook, bad_call)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_unload_call_xpath &lt;- "\n      //expr[SYMBOL[text() = '.Last.lib' or text() = '.onDetach']]\n      /following-sibling::expr[FUNCTION]\n      //SYMBOL_FUNCTION_CALL[text() = 'library.dynam.unload']\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_unload_call_expr &lt;- xml2::xml_find_all(xml, bad_unload_call_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_unload_call_lints &lt;- xml_nodes_to_lints(bad_unload_call_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression, function(expr) sprintf("Use library.dynam.unload() calls in .onUnload(), not %s().", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             get_hook(expr)), type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     unload_arg_name_xpath &lt;- "\n    //expr[SYMBOL[text() = '.onDetach' or text() = '.Last.lib']]\n    /following-sibling::expr[\n      FUNCTION\n      and (\n        count(SYMBOL_FORMALS) != 1\n        or SYMBOL_FORMALS[not(starts-with(text(), 'lib'))]\n      )\n    ]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     unload_arg_name_expr &lt;- xml2::xml_find_all(xml, unload_arg_name_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     unload_arg_name_lints &lt;- xml_nodes_to_lints(unload_arg_name_expr, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         source_expression, function(expr) sprintf("%s() should take one argument starting with 'lib'.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             get_hook(expr)), type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return(c(onload_bad_msg_call_lints, onattach_bad_msg_call_lints, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         load_arg_name_lints, library_require_lints, bad_unload_call_lints, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         unload_arg_name_lints))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90532d1e8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9034c0a68&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "package_hooks_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $paren_body_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- paste("//expr[", "@line1 = preceding-sibling::FUNCTION/@line1", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "|", "preceding-sibling::IF/@line1", "|", "preceding-sibling::WHILE/@line1", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "|", "preceding-sibling::OP-LAMBDA/@line1", "and", "@col1 = preceding-sibling::OP-RIGHT-PAREN/@col1 + 1", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "]", "|", "//expr[", "@line1 = preceding-sibling::forcond/@line1", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "and", "@col1 = preceding-sibling::forcond/OP-RIGHT-PAREN/@col1 + 1", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     matched_expressions &lt;- xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(matched_expressions, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "There should be a space between right parenthesis and a body expression.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c904521f78&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90351ff18&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "paren_body_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $paste_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (allow_empty_sep) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         empty_sep_lints &lt;- NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sep_xpath &lt;- "//expr[\n        expr[SYMBOL_FUNCTION_CALL[text() = 'paste']]\n        and SYMBOL_SUB[text() = 'sep']/following-sibling::expr[1][STR_CONST]\n      ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         empty_sep_expr &lt;- xml2::xml_find_all(xml, sep_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sep_value &lt;- get_r_string(empty_sep_expr, xpath = "./SYMBOL_SUB[text() = 'sep']/following-sibling::expr[1]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         empty_sep_lints &lt;- xml_nodes_to_lints(empty_sep_expr[!nzchar(sep_value)], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             source_expression = source_expression, lint_message = "paste0(...) is better than paste(..., sep = \"\").", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (allow_to_string) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         to_string_lints &lt;- NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         to_string_xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'paste' or text() = 'paste0']]\n        and count(expr) = 3\n        and SYMBOL_SUB[text() = 'collapse']/following-sibling::expr[1][STR_CONST]\n      ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         to_string_expr &lt;- xml2::xml_find_all(xml, to_string_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         collapse_value &lt;- get_r_string(to_string_expr, xpath = "./SYMBOL_SUB[text() = 'collapse']/following-sibling::expr[1]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         to_string_lints &lt;- xml_nodes_to_lints(to_string_expr[collapse_value == </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ", "], source_expression = source_expression, lint_message = paste("toString(.) is more expressive than paste(., collapse = \", \").", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "Note also glue::glue_collapse() and and::and()", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "for constructing human-readable / translation-friendly lists"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paste0_sep_xpath &lt;- "//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'paste0']]\n      and SYMBOL_SUB[text() = 'sep']\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paste0_sep_expr &lt;- xml2::xml_find_all(xml, paste0_sep_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paste0_sep_lints &lt;- xml_nodes_to_lints(paste0_sep_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "sep= is not a formal argument to paste0(); did you mean to use paste(), or collapse=?", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     c(empty_sep_lints, to_string_lints, paste0_sep_lints)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9019a0890&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903586428&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "paste_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pipe_call_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[preceding-sibling::SPECIAL[text() = '%&gt;%'] and *[1][self::SYMBOL]]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "Use explicit calls in magrittr pipes, i.e., `a %&gt;% foo` should be `a %&gt;% foo()`.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9019989f0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9035e5868&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "pipe_call_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pipe_continuation_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     x &lt;- global_xml_parsed_content(source_expression)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (is.null(x)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     multiline_pipe_test &lt;- paste("//SPECIAL[text() = '%&gt;%'", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "and parent::expr[@line1 &lt; @line2]", "and preceding-sibling::*/descendant-or-self::SPECIAL[text() = '%&gt;%']", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "and (", "(preceding-sibling::*/descendant-or-self::expr/@line2 = ", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "  following-sibling::*/descendant-or-self::expr/@line1)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "or (@line1 = preceding-sibling::*/descendant-or-self::SPECIAL[text() = '%&gt;%']/@line1)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ")", "]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     pipe_exprs &lt;- xml_find_all(x, multiline_pipe_test)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(pipe_exprs, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("`%&gt;%` should always have a space before it and a new line after it,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "unless the full pipeline fits on one line."), type = "style")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c904523d80&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903644ea0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "pipe_continuation_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $redundant_ifelse_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tf_xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[ {xp_text_in_table(ifelse_funs)} ]]\n      and expr[NUM_CONST[text() = 'TRUE']]\n      and expr[NUM_CONST[text() = 'FALSE']]\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tf_expr &lt;- xml2::xml_find_all(xml, tf_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tf_lints &lt;- xml_nodes_to_lints(tf_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             matched_call &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             first_arg &lt;- xml2::xml_find_chr(expr, "string(expr[3]/NUM_CONST)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             second_arg &lt;- xml2::xml_find_chr(expr, "string(expr[4]/NUM_CONST)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("Just use the logical condition (or its negation) directly instead of calling %s(x, %s, %s)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_call, first_arg, second_arg)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (allow10) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         num_lints &lt;- NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         num_xpath &lt;- glue::glue("//expr[\n        expr[SYMBOL_FUNCTION_CALL[ {xp_text_in_table(ifelse_funs)} ]]\n        and expr[NUM_CONST[text() = '1' or text() = '1L']]\n        and expr[NUM_CONST[text() = '0' or text() = '0L']]\n      ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         num_expr &lt;- xml2::xml_find_all(xml, num_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         num_lints &lt;- xml_nodes_to_lints(num_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 matched_call &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 first_arg &lt;- xml2::xml_find_chr(expr, "string(expr[3]/NUM_CONST)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 second_arg &lt;- xml2::xml_find_chr(expr, "string(expr[4]/NUM_CONST)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 replacement &lt;- if (any(c(first_arg, second_arg) %in% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   c("0", "1"))) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   "as.numeric"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else "as.integer"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 message &lt;- sprintf("Prefer %s(x) to %s(x, %s, %s) if really needed,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   replacement, matched_call, first_arg, second_arg)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paste(message, "but do note that R will usually convert logical vectors to 0/1 on the fly when needed.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return(c(tf_lints, num_lints))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9019928a0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9036a62e0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "redundant_ifelse_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $regex_subset_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     parent_expr_cond &lt;- xp_and("OP-LEFT-BRACKET", "not(parent::*[LEFT_ASSIGN or EQ_ASSIGN or RIGHT_ASSIGN])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     subset_cond_fmt &lt;- xp_and("expr[SYMBOL_FUNCTION_CALL[%s]]", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "expr[position() = %d] = parent::expr/expr[1]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     grep_xpath &lt;- sprintf("//expr[%s]/expr[%s]", parent_expr_cond, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sprintf(subset_cond_fmt, xp_text_in_table(c("grep", "grepl")), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             3L))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     grep_expr &lt;- xml2::xml_find_all(xml, grep_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     grep_lints &lt;- xml_nodes_to_lints(grep_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("Prefer grep(pattern, x, ..., value = TRUE) over", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "x[grep(pattern, x, ...)] and x[grepl(pattern, x, ...)]."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     stringr_xpath &lt;- sprintf("//expr[%s]/expr[%s]", parent_expr_cond, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sprintf(subset_cond_fmt, xp_text_in_table(c("str_detect", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "str_which")), 2L))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     stringr_expr &lt;- xml2::xml_find_all(xml, stringr_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     stringr_lints &lt;- xml_nodes_to_lints(stringr_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("Prefer stringr::str_subset(x, pattern) over", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "x[str_detect(x, pattern)] and x[str_which(x, pattern)]."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return(c(grep_lints, stringr_lints))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901986868&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903709608&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "regex_subset_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $semicolon_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tokens &lt;- with_id(source_expression, ids_with_token(source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "';'"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     is_trailing &lt;- is_trailing_sc(tokens, source_expression)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     to_keep &lt;- (is_trailing &amp; !allow_trailing) | (!is_trailing &amp; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         !allow_compound)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tokens &lt;- tokens[to_keep, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     are_trailing &lt;- is_trailing[to_keep]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Map(function(token, is_trailing) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         msg &lt;- if (is_trailing) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "Trailing semicolons are not needed."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "Compound semicolons are discouraged. Replace them by a newline."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Lint(filename = source_expression[["filename"]], line_number = token[["line1"]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_number = token[["col1"]], type = "style", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             message = msg, line = source_expression[["lines"]][[as.character(token[["line1"]])]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ranges = list(c(token[["col1"]], token[["col2"]])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, split(tokens, seq_len(nrow(tokens))), are_trailing)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90452a800&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90376ca10&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "semicolon_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $seq_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_funcs &lt;- c("length", "nrow", "ncol", "NROW", "NCOL", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "dim")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      expr[NUM_CONST[text() =  '1' or text() =  '1L']]\n      and OP-COLON\n      and expr[expr[(expr|self::*)[SYMBOL_FUNCTION_CALL[ {xp_text_in_table(bad_funcs)} ]]]]\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     badx &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     get_fun &lt;- function(x, n) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         funcall &lt;- xml2::xml_children(xml2::xml_children(x)[[n]])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         fun &lt;- gsub("\\(.*\\)", "(...)", trimws(xml2::xml_text(funcall[[1L]])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (fun %in% bad_funcs) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste0(fun, "(...)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else fun</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(badx, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             dot_expr1 &lt;- get_fun(expr, 1L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             dot_expr2 &lt;- get_fun(expr, 3L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (any(grepl("length(", c(dot_expr1, dot_expr2), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 fixed = TRUE))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 replacement &lt;- "seq_along"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 replacement &lt;- "seq_len"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             sprintf("%s:%s is likely to be wrong in the empty edge case. Use %s() instead.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 dot_expr1, dot_expr2, replacement)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9045306e8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9037ca160&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "seq_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $single_quotes_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     content &lt;- source_expression$full_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     str_idx &lt;- which(content$token == "STR_CONST")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     squote_matches &lt;- which(re_matches(content[str_idx, "text"], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         rex(start, zero_or_one(character_class("rR")), single_quote, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             any_non_double_quotes, single_quote, end)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(squote_matches, function(id) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         with(content[str_idx[id], ], {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line &lt;- source_expression$file_lines[[line1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             col2 &lt;- if (line1 == line2) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 col2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else nchar(line)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Lint(filename = source_expression$filename, line_number = line1, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 column_number = col1, type = "style", message = "Only use double-quotes.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line = line, ranges = list(c(col1, col2)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c904535cd8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90382f4e8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "single_quotes_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $spaces_inside_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     left_expr &lt;- xml2::xml_find_all(xml, left_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     left_msg &lt;- ifelse(xml2::xml_text(left_expr) == "[", "Do not place spaces after square brackets.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "Do not place spaces after parentheses.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     right_expr &lt;- xml2::xml_find_all(xml, right_xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     right_msg &lt;- ifelse(xml2::xml_find_chr(right_expr, "string(./following-sibling::*[1])") == </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "]", "Do not place spaces before square brackets.", "Do not place spaces before parentheses.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(c(left_expr, right_expr), source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = c(left_msg, right_msg), range_start_xpath = "number(./@col2 + 1)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         range_end_xpath = "number(./following-sibling::*[1]/@col1 - 1)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90453e528&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90388eb58&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "spaces_inside_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $spaces_left_parentheses_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath &lt;- "//OP-LEFT-PAREN[@start - 1 = ancestor::expr/preceding-sibling::OP-SEMICOLON/@end]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else if (is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if_while_cond &lt;- "@start - 1 = preceding-sibling::*[self::IF or self::WHILE]/@end"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         for_cond &lt;- "@start - 1 = parent::forcond/preceding-sibling::FOR/@end"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         unary_nodes &lt;- infix_metadata[infix_metadata$unary, "xml_tag"]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         unary_selves &lt;- paste0("self::", unary_nodes, "[preceding-sibling::*]", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             collapse = " or ")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         binary_nodes &lt;- c(infix_metadata[infix_metadata$low_precedence &amp; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             !infix_metadata$unary, "xml_tag"], "OP-COMMA", "OP-LEFT-BRACE", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "ELSE", "IN")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         binary_selves &lt;- paste0("self::", binary_nodes, collapse = " or ")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         infix_cond &lt;- sprintf("not(preceding-sibling::*) and (@start - 1 = ancestor::expr/preceding-sibling::*[%s]/@end)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste(unary_selves, "or", binary_selves))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath &lt;- sprintf("//OP-LEFT-PAREN[(%s) or (%s) or (%s)]", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if_while_cond, for_cond, infix_cond)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_paren &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_paren, source_expression, lint_message = "Place a space before left parenthesis, except in a function call.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "style")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9045422f8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903919218&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "spaces_left_parentheses_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sprintf_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      expr/SYMBOL_FUNCTION_CALL[text() = 'sprintf'] and\n      OP-LEFT-PAREN/following-sibling::expr[1]/STR_CONST\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     sprintf_calls &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     message &lt;- vapply(sprintf_calls, capture_sprintf_warning, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         character(1L))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     has_message &lt;- !is.na(message)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(sprintf_calls[has_message], source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = message[has_message], type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901982c58&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c90397c908&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "sprintf_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $strings_as_factors_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     c_combine_strings &lt;- "\n      expr[SYMBOL_FUNCTION_CALL[text() = 'c']]\n      and expr[STR_CONST]\n      and not(expr[SYMBOL or expr])\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     known_character_funs &lt;- c("character", "as.character", "paste", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "sprintf", "format", "formatC", "prettyNum", "toString", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "encodeString")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'data.frame']]\n      and expr[\n        (\n          STR_CONST[not(following-sibling::*[1][self::EQ_SUB])]\n          or ( {c_combine_strings} )\n          or expr[\n            SYMBOL_FUNCTION_CALL[text() = 'rep']\n            and following-sibling::expr[1][STR_CONST or ({c_combine_strings})]\n          ]\n          or expr[SYMBOL_FUNCTION_CALL[ {xp_text_in_table(known_character_funs)} ]]\n        )\n        and not(preceding-sibling::*[2][self::SYMBOL_SUB and text() = 'row.names'])\n      ]\n      and not(SYMBOL_SUB[text() = 'stringsAsFactors'])\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = paste("This code relies on the default value of stringsAsFactors,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "which changed in version R 4.0. Please supply an explicit value for", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "stringsAsFactors for this code to work with versions of R both before", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "and after this switch."), type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901981be0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c9039dbfb0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "strings_as_factors_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $system_file_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "//expr[\n      (\n        expr/SYMBOL_FUNCTION_CALL[text() = 'system.file']\n        and expr/expr/SYMBOL_FUNCTION_CALL[text() = 'file.path']\n      ) or (\n        expr/SYMBOL_FUNCTION_CALL[text() = 'file.path']\n        and expr/expr/SYMBOL_FUNCTION_CALL[text() = 'system.file']\n      )\n    ]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             outer_call &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (outer_call == "system.file") {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 bad_usage &lt;- "system.file(file.path(\"data\", \"model.csv\"), package = \"myrf\")"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 bad_usage &lt;- "file.path(system.file(package = \"myrf\"), \"data\", \"model.csv\")"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste("Use the `...` argument of system.file() to expand paths,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "e.g. system.file(\"data\", \"model.csv\", package = \"myrf\") instead of", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 bad_usage)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90197d9b0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903a410b8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "system_file_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $T_and_F_symbol_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- paste0("//SYMBOL[", "(text() = 'T' or text() = 'F')", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         " and not(preceding-sibling::OP-DOLLAR)", " and not(parent::expr[", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "  following-sibling::LEFT_ASSIGN", "  or preceding-sibling::RIGHT_ASSIGN", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "  or following-sibling::EQ_ASSIGN", "])", "]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath_assignment &lt;- paste0("//SYMBOL[", "(text() = 'T' or text() = 'F')", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         " and not(preceding-sibling::OP-DOLLAR)", " and parent::expr[", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "  following-sibling::LEFT_ASSIGN", "  or preceding-sibling::RIGHT_ASSIGN", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "  or following-sibling::EQ_ASSIGN", " ]", "]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_exprs &lt;- xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_assigns &lt;- xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath_assignment)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     replacement_map &lt;- c(T = "TRUE", F = "FALSE")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     make_lints &lt;- function(expr, fmt) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xml_nodes_to_lints(xml = expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 symbol &lt;- xml2::xml_text(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 sprintf(fmt, replacement_map[[symbol]], symbol)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }, type = "style", column_number_xpath = "number(./@col2 + 1)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             range_end_xpath = "number(./@col2 + 1)")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     c(make_lints(bad_exprs, "Use %s instead of the symbol %s."), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         make_lints(bad_assigns, "Don't use %2$s as a variable name, as it can break code relying on %2$s being %1$s."))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c904545728&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903aa2648&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "T_and_F_symbol_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $todo_comment_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tokens &lt;- with_id(source_expression, ids_with_token(source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "COMMENT"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     are_todo &lt;- re_matches(tokens[["text"]], rex(one_or_more("#"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         any_spaces, or(todo)), ignore.case = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tokens &lt;- tokens[are_todo, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(split(tokens, seq_len(nrow(tokens))), function(token) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Lint(filename = source_expression[["filename"]], line_number = token[["line1"]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_number = token[["col1"]], type = "style", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             message = "TODO comments should be removed.", line = source_expression[["lines"]][[as.character(token[["line1"]])]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ranges = list(c(token[["col1"]], token[["col2"]])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901975780&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903b03af8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "todo_comment_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $trailing_blank_lines_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     blanks &lt;- re_matches(source_expression$file_lines, rex(start, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         any_spaces, end))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     line_number &lt;- length(source_expression$file_lines)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints &lt;- list()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     while (line_number &gt; 0L &amp;&amp; (is.na(blanks[[line_number]]) || </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         isTRUE(blanks[[line_number]]))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (!is.na(blanks[[line_number]])) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lints[[length(lints) + 1L]] &lt;- Lint(filename = source_expression$filename, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line_number = line_number, column_number = 1L, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 type = "style", message = "Trailing blank lines are superfluous.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line = source_expression$file_lines[[line_number]])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         line_number &lt;- line_number - 1L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (identical(source_expression$terminal_newline, FALSE)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         last_line &lt;- tail(source_expression$file_lines, 1L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lints[[length(lints) + 1L]] &lt;- Lint(filename = source_expression$filename, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line_number = length(source_expression$file_lines), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_number = nchar(last_line) + 1L, type = "style", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             message = "Missing terminal newline.", line = last_line)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lints</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c8ff31fee0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903b68c98&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "trailing_blank_lines_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $trailing_whitespace_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     res &lt;- re_matches(source_expression$file_lines, rex(blanks, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         end), locations = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (isTRUE(allow_empty_lines)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         bad_lines &lt;- which(res$start &gt; 1L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         bad_lines &lt;- which(!is.na(res$start))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (isTRUE(allow_in_strings) &amp;&amp; !is.null(source_expression$full_xml_parsed_content)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         all_str_consts &lt;- xml2::xml_find_all(source_expression$full_xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "//STR_CONST")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         start_lines &lt;- as.integer(xml2::xml_attr(all_str_consts, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "line1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         end_lines &lt;- as.integer(xml2::xml_attr(all_str_consts, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "line2"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         is_in_str &lt;- vapply(bad_lines, function(ln) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             any(start_lines &lt;= ln &amp; ln &lt; end_lines)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, logical(1L))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         bad_lines &lt;- bad_lines[!is_in_str]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(bad_lines, function(line) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Lint(filename = source_expression$filename, line_number = line, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_number = res$start[[line]], type = "style", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             message = "Trailing whitespace is superfluous.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line = source_expression$file_lines[[line]], ranges = list(c(res$start[[line]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 res$end[[line]])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90454adf8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903bcdfd0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "trailing_whitespace_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $undesirable_function_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     matched_nodes &lt;- xml2::xml_find_all(source_expression$xml_parsed_content, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(matched_nodes, function(node) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         fun_name &lt;- xml2::xml_text(node)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         msg &lt;- sprintf("Function \"%s\" is undesirable.", fun_name)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         alternative &lt;- fun[[fun_name]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (!is.na(alternative)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             msg &lt;- paste(msg, sprintf("As an alternative, %s.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 alternative))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         line &lt;- xml2::xml_attr(node, "line1")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         col1 &lt;- as.integer(xml2::xml_attr(node, "col1"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         col2 &lt;- as.integer(xml2::xml_attr(node, "col2"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Lint(filename = source_expression$filename, line_number = as.integer(line), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             column_number = col1, type = "style", message = msg, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             line = source_expression$lines[[line]], ranges = list(c(col1, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 col2)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901968e50&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903c31330&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "undesirable_function_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $undesirable_operator_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_op &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_op, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             op_name &lt;- xml2::xml_text(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             msg &lt;- sprintf("Operator `%s` is undesirable.", op_name)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             alt_op &lt;- op[[op_name]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (!is.na(alt_op)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 msg &lt;- paste(msg, alt_op)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             msg</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90195ff98&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903cbe998&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "undesirable_operator_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $unneeded_concatenation_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tokens &lt;- source_expression[["parsed_content"]] &lt;- filter_out_token_type(source_expression[["parsed_content"]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "expr")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msg_empty &lt;- paste("Unneeded concatenation without arguments.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "Replace the \"c\" call by NULL or, whenever possible,", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "vector() seeded with the correct type and/or length.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msg_const &lt;- "Unneeded concatenation of a constant. Remove the \"c\" call."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lapply(ids_with_token(source_expression, "SYMBOL_FUNCTION_CALL"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         function(token_num) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             num_args &lt;- get_num_concat_args(token_num, tokens)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (num_args == 0L || num_args == 1L) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 token &lt;- with_id(source_expression, token_num)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 start_col_num &lt;- token[["col1"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 end_col_num &lt;- token[["col2"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line_num &lt;- token[["line1"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 line &lt;- source_expression[["lines"]][[as.character(line_num)]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Lint(filename = source_expression[["filename"]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   line_number = line_num, column_number = start_col_num, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   type = "warning", message = if (num_args) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     msg_const</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   else msg_empty, line = line, ranges = list(c(start_col_num, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     end_col_num)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90193ac48&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903dc8818&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "unneeded_concatenation_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $unreachable_code_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- "\n    //FUNCTION\n    /following-sibling::expr\n    /*[\n      self::expr\n      and expr[not(OP-DOLLAR) and SYMBOL_FUNCTION_CALL[text() = 'return' or text() = 'stop']]\n      and (position() != last() - 1 or not(following-sibling::OP-RIGHT-BRACE))\n      and @line2 &lt; following-sibling::*[1]/@line2\n    ]\n    /following-sibling::*[1]\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "Code and comments coming after a top-level return() or stop() should be removed.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c901937dc8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903e30100&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "unreachable_code_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $unused_import_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "file")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$full_xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     import_exprs &lt;- xml2::xml_find_all(xml, "//expr[\n        expr[SYMBOL_FUNCTION_CALL[text() = 'library' or text() = 'require']]\n        and\n        (\n          not(SYMBOL_SUB[\n            text() = 'character.only' and\n            following-sibling::expr[1][NUM_CONST[text() = 'TRUE'] or SYMBOL[text() = 'T']]\n          ]) or\n          expr[2][STR_CONST]\n        )\n      ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (length(import_exprs) == 0L) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     imported_pkgs &lt;- xml2::xml_find_chr(import_exprs, "string(expr[STR_CONST|SYMBOL])")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     imported_pkgs &lt;- as.character(parse(text = imported_pkgs, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         keep.source = FALSE))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xp_used_symbols &lt;- paste("//SYMBOL_FUNCTION_CALL[not(preceding-sibling::NS_GET)]/text()", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "//SYMBOL/text()", "//SPECIAL/text()", sep = " | ")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     used_symbols &lt;- xml2::xml_text(xml2::xml_find_all(xml, xp_used_symbols))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     is_used &lt;- vapply(imported_pkgs, function(pkg) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (pkg %in% except_packages || !requireNamespace(pkg, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             quietly = TRUE)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             return(TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         package_exports &lt;- getNamespaceExports(pkg)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         any(package_exports %in% used_symbols)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, logical(1L))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     is_ns_used &lt;- vapply(imported_pkgs, function(pkg) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ns_usage &lt;- xml2::xml_find_first(xml, paste0("//SYMBOL_PACKAGE[text() = '", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             pkg, "']"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         !identical(ns_usage, xml2::xml_missing())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }, logical(1L))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     is_unused &lt;- !is_used</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (allow_ns_usage) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         is_unused[is_ns_used] &lt;- FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(import_exprs[is_unused], source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(import_expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             pkg &lt;- get_r_string(import_expr, xpath = "expr[STR_CONST|SYMBOL]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (is_ns_used[match(pkg, imported_pkgs)]) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paste0("package '", pkg, "' is only used by namespace. ", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   "Check that it is installed using loadNamespace() instead.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paste0("package '", pkg, "' is attached but never used.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c90192fa48&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903ec69f0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "unused_import_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vector_logic_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = "Conditional expressions require scalar logical operators (&amp;&amp; and ||)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c9045532c8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903f2b0b0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "vector_logic_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $yoda_test_linter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (source_expression) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is_lint_level(source_expression, "expression")) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml &lt;- source_expression$xml_parsed_content</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     const_condition &lt;- "\n      NUM_CONST\n      or (STR_CONST and not(OP-DOLLAR))\n      or ((OP-PLUS or OP-MINUS) and count(expr[NUM_CONST]) = 2)\n    "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xpath &lt;- glue::glue("//expr[\n      expr[SYMBOL_FUNCTION_CALL[text() = 'expect_equal' or text() = 'expect_identical' or text() = 'expect_setequal']]\n      and expr[2][ {const_condition} ]\n      and not(preceding-sibling::*[self::PIPE or self::SPECIAL[text() = '%&gt;%']])\n    ]")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     bad_expr &lt;- xml2::xml_find_all(xml, xpath)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     xml_nodes_to_lints(bad_expr, source_expression = source_expression, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lint_message = function(expr) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             matched_call &lt;- xp_call_name(expr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             second_const &lt;- xml2::xml_find_first(expr, glue::glue("expr[position() = 3 and ({const_condition})]"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (is.na(second_const)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paste("Tests should compare objects in the order 'actual', 'expected', not the reverse.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   sprintf("For example, do %1$s(foo(x), 2L) instead of %1$s(2L, foo(x)).", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     matched_call))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 sprintf("Avoid storing placeholder tests like %s(1, 1)", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   matched_call)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }, type = "warning")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x55c905338f80&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x55c903f8c5d0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "linter"         "lintr_function"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"name")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "yoda_test_linter"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Get all linters tagged as "default" from lintr and mypkg</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="fu">linters_with_tags</span><span class="op">(</span><span class="st">"default"</span>, packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lintr"</span>, <span class="st">"mypkg"</span><span class="op">)</span><span class="op">)</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Jim Hester, Florent Angly, Russ Hyde, Michael Chirico, Kun Ren, Alexander Rosenstock.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer></div>

  

  

  </body></html>

